apiVersion: v1
kind: Pod
metadata:
  annotations:
    kubernetes.io/psp: gardener.privileged
  labels:
    app: root
    component: reserved-resources-recommender
    networking.gardener.cloud/to-dns: allowed
    networking.gardener.cloud/to-shoot-apiserver: allowed
  name: reserved-resources-recommender
spec:
#  priorityClassName: system-cluster-critical
  containers:
    - image: eu.gcr.io/gardener-project/gardener/reserved-resources-recommender:latest
      imagePullPolicy: Always
      name: reconciler
      env:
        - name: MEMORY_SAFETY_MARGIN_ABSOLUTE
          value: 100Mi
        - name: CGROUPS_HIERARCHY_ROOT
          value: "/sys/fs/cgroup"
        - name: KUBELET_DIRECTORY
          # also adjust Volume if this is changed
          value: "/var/lib/kubelet/"
      resources:
        requests:
          memory: "16Mi"
          cpu: "20m"
        limits:
          memory: "30Mi"
          cpu: "40m"
      securityContext:
        privileged: true
        runAsUser: 0
      stdin: true
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
#        - mountPath: /run/systemd/private
#          name: systemd
        - mountPath: /proc/meminfo
          name: proc
        - mountPath: /var/lib/kubelet
          name: kubelet
#        - mountPath: /var/lib/kubelet/dynamic-resource-reservations/kubelet.sock
#          name: kubelet-dynamic-resource-reservations-socket
        - mountPath: /sys/fs/cgroup
          name: cgroup-hierarchy
  dnsPolicy: ClusterFirst
  enableServiceLinks: false
  hostNetwork: true
  hostPID: true
  nodeName: shoot--d060239--dev-seed-gcp-test-z1-5f5fc-d5bm4
  restartPolicy: Always
  schedulerName: default-scheduler
  securityContext: {}
  serviceAccount: default
  serviceAccountName: default
  terminationGracePeriodSeconds: 30
  tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: pool.worker.gardener.cloud/dedicated-for
      operator: Equal
      value: etcd
  volumes:
#    - hostPath:
#        path: /run/systemd/private
#        type: ""
#      name: systemd
    - hostPath:
        path: /var/lib/kubelet
        type: ""
      name: kubelet
    - hostPath:
        path: /proc/meminfo
        type: ""
      name: proc
    - hostPath:
        path: /sys/fs/cgroup
        type: ""
      name: cgroup-hierarchy
      # TODO: add all host paths for disk based calculations

